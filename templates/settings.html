{% extends 'base.html' %}
{% block title %}Settings - DengueTect{% endblock %}
{% block content %}
  <h2 class="page-title">Settings</h2>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-brightness-high me-2"></i>Appearance</h3>
    <div class="row between">
      <div>
        <p class="strong">Dark Mode</p>
        <p class="muted">Switch between light and dark themes</p>
      </div>
      <label class="switch">
        <input type="checkbox" id="toggle-dark" />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-bell me-2"></i>Notifications</h3>
    <div class="row between">
      <div>
        <p class="strong">Health Reminders</p>
        <p class="muted">Get notified about dengue prevention tips</p>
      </div>
      <label class="switch"><input type="checkbox" checked /><span class="slider"></span></label>
    </div>
    <div class="row between">
      <div>
        <p class="strong">Risk Alerts</p>
        <p class="muted">Receive alerts for high-risk assessments</p>
      </div>
      <label class="switch"><input type="checkbox" checked /><span class="slider"></span></label>
    </div>
  </div>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-shield-check me-2"></i>Privacy & Permissions</h3>
    <div class="row between">
      <div class="row gap">
        <div>üì∑</div>
        <div>
          <p class="strong">Camera Access</p>
          <p class="muted">For bite photo analysis</p>
        </div>
      </div>
      <label class="switch"><input type="checkbox" checked /><span class="slider"></span></label>
    </div>
    <div class="row between">
      <div class="row gap">
        <div>üìç</div>
        <div>
          <p class="strong">Location Access</p>
          <p class="muted">Find nearby health centers</p>
        </div>
      </div>
      <label class="switch"><input type="checkbox" checked /><span class="slider"></span></label>
    </div>
    <div class="row between">
      <div>
        <p class="strong">Data Sharing</p>
        <p class="muted">Anonymous data for public health</p>
      </div>
      <label class="switch"><input type="checkbox" /><span class="slider"></span></label>
    </div>
  </div>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-geo-alt me-2"></i>Language & Region</h3>
    <div class="stack">
      <a class="btn outline" href="#">Language: English</a>
      <a class="btn outline" href="#">Region: Philippines</a>
    </div>
  </div>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-activity me-2"></i>Clinical assumptions</h3>
    <form action="/settings/prevalence" method="post" class="stack">
      <label class="strong" for="pretest_prevalence">Pretest prevalence for suspected dengue (percent)</label>
      <input type="text" id="pretest_prevalence" name="pretest_prevalence" value="{{ ((user_prev if user_prev is not none else default_prev) * 100) | round(1) }}" placeholder="5.5" />
      <small class="muted">We recalibrate the model intercept to this prevalence. Use a higher value during local outbreaks to reflect higher baseline risk. You can also enter a fraction (e.g., 0.055).</small>
      <button class="btn primary" type="submit">Save</button>
    </form>
  </div>

  <div class="card soft">
    <h3 class="card-title"><i class="bi bi-info-circle me-2"></i>About</h3>
    <div class="stack">
      <a class="btn outline" data-bs-toggle="collapse" href="#privacyCollapse" role="button" aria-expanded="false" aria-controls="privacyCollapse">Privacy Policy</a>
      <div class="collapse" id="privacyCollapse">
        <div class="stack" style="margin-top:8px">
          <p class="muted">We value your privacy. This demo app stores minimal data locally in a JSON file for your account, assessments, and settings. No data is shared externally. Do not use real personal information in a demo environment.</p>
          <label class="inline-check"><input type="checkbox" id="ackPrivacy" /><span>I have read the Privacy Policy</span></label>
        </div>
      </div>

      <a class="btn outline" data-bs-toggle="collapse" href="#termsCollapse" role="button" aria-expanded="false" aria-controls="termsCollapse">Terms of Service</a>
      <div class="collapse" id="termsCollapse">
        <div class="stack" style="margin-top:8px">
          <p class="muted">This is an educational demo, not medical advice. The risk estimates are not clinically validated and should not be used for diagnosis or treatment. Always consult a qualified clinician for medical decisions.</p>
          <label class="inline-check"><input type="checkbox" id="ackTerms" /><span>I agree to the Terms of Service</span></label>
        </div>
      </div>

      <span class="muted">App Version: 1.0.0</span>
    </div>
  </div>

  <a class="btn linkback" href="/dashboard">‚Üê Back</a>
  <script>
    (function(){
      var el = document.documentElement;
      var checkbox = document.getElementById('toggle-dark');
      var current = el.getAttribute('data-theme') || 'light';
      checkbox.checked = current === 'dark';
      function setTheme(next){
        el.setAttribute('data-theme', next);
        try{localStorage.setItem('theme', next);}catch(e){}
        try{document.cookie = 'theme=' + next + '; path=/; max-age=31536000';}catch(e){}
      }
      checkbox.addEventListener('change', function(e){
        setTheme(e.target.checked ? 'dark' : 'light');
      });
    })();
  </script>
  <script>
    (function(){
      function sync(id, key){
        var box = document.getElementById(id);
        if (!box) return;
        try { box.checked = localStorage.getItem(key) === '1'; } catch(e){}
        box.addEventListener('change', function(){
          try { localStorage.setItem(key, box.checked ? '1' : '0'); } catch(e){}
        });
      }
      document.addEventListener('DOMContentLoaded', function(){
        sync('ackPrivacy','ack_privacy');
        sync('ackTerms','ack_terms');
      });
    })();
  </script>
{% endblock %}
